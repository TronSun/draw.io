<mxfile host="app.diagrams.net" modified="2021-06-04T04:04:56.583Z" agent="5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36" etag="evl1Xe7K9LPr4SrNmMpp" version="14.7.3" type="github">
  <diagram id="zCqKV0-2973yA6inryoA" name="Page-1">
    <mxGraphModel dx="1186" dy="1838" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-2" value="增研前端" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="400" y="120" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-3" value="增研后端" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="720" y="120" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-4" value="微信公众号/小程序&lt;br&gt;平台" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="1040" y="120" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-1" value="微信公众号/小程序用户" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="40" y="120" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-7" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;fillColor=#dae8fc;strokeColor=#6c8ebf;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="120" y="640" as="sourcePoint" />
            <mxPoint x="120" y="161" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-9" value="" style="endArrow=classic;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="120" y="240" as="sourcePoint" />
            <mxPoint x="460" y="240" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-10" value="&lt;font style=&quot;font-size: 13px&quot;&gt;1.绑定小程序/公众号&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#6c8ebf;fillColor=#dae8fc;" vertex="1" parent="1">
          <mxGeometry x="225" y="200" width="130" height="20" as="geometry" />
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-12" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1" target="qW-GwzM_9mIQ4SGtCaXA-2">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="460" y="640" as="sourcePoint" />
            <mxPoint x="490" y="160" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-13" value="说明：&lt;br&gt;&lt;span style=&quot;font-size: 16px ; color: rgb(34 , 34 , 34)&quot;&gt;&lt;br&gt;&lt;font face=&quot;consolas, liberation mono, menlo, courier, monospace&quot;&gt;&lt;span style=&quot;font-size: 15px ; background-color: rgb(249 , 249 , 250)&quot;&gt;&lt;br&gt;1.用户主动触发绑定小程序或者公众号&lt;br&gt;&lt;br&gt;2.获取预授权码需要登录微信开放平台-&amp;gt;管理中心-&amp;gt;第三方平台-&amp;gt;授权事件接口URL(URL为具体的请求接口)，&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px ; color: rgb(34 , 34 , 34)&quot;&gt;微信服务器会向其 ”授权事件接收URL”&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-size: 16px ; color: rgb(34 , 34 , 34)&quot;&gt;&lt;font face=&quot;consolas, liberation mono, menlo, courier, monospace&quot;&gt;&lt;span style=&quot;background-color: rgb(249 , 249 , 250)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px ; color: rgb(34 , 34 , 34)&quot;&gt;每隔 10 分钟以&amp;nbsp;&lt;/span&gt;&lt;code style=&quot;font-size: 16px ; margin: 0px ; padding: 2px 0.4em ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , &amp;#34;courier&amp;#34; , monospace ; direction: ltr ; background-color: rgb(249 , 249 , 250) ; border-radius: 2px ; display: inline-block ; color: rgb(34 , 34 , 34)&quot;&gt;POST&lt;/code&gt;&lt;span style=&quot;font-size: 16px ; color: rgb(34 , 34 , 34)&quot;&gt;&amp;nbsp;的方式推送 component_verify_ticket,调用获取令牌接口，再调用获取预授权码接口拿到预授权码返回给前端&lt;/span&gt;&lt;span style=&quot;font-size: 16px ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , &amp;#34;courier&amp;#34; , monospace ; background-color: rgb(249 , 249 , 250) ; color: rgb(34 , 34 , 34)&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;font&gt;&lt;span style=&quot;font-size: 16px ; color: rgb(34 , 34 , 34) ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , &amp;#34;courier&amp;#34; , monospace ; background-color: rgb(249 , 249 , 250)&quot;&gt;3.&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;font&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;pc端授权链接：&lt;/span&gt;&lt;font color=&quot;#222222&quot; face=&quot;consolas, liberation mono, menlo, courier, monospace&quot; style=&quot;font-size: 16px&quot;&gt;&lt;span style=&quot;background-color: rgb(249 , 249 , 250)&quot;&gt;https://mp.weixin.qq.com/cgi-bin/componentloginpage?component_appid=xxxx&amp;amp;pre_auth_code=xxxxx&amp;amp;redirect_uri=xxxx&amp;amp;auth_type=xxx&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-size: 16px ; background-color: rgb(249 , 249 , 250)&quot;&gt;&lt;font color=&quot;#222222&quot; face=&quot;consolas, liberation mono, menlo, courier, monospace&quot; style=&quot;font-size: 16px&quot;&gt;&amp;nbsp;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;移动端授权链接：https://mp.weixin.qq.com/safe/bindcomponent?action=bindcomponent&amp;amp;no_scan=1&amp;amp;component_appid=xxxx&amp;amp;pre_auth_code=xxxxx&amp;amp;redirect_uri=xxxx&amp;amp;auth_type=xxx&amp;amp;biz_appid=xxxx#wechat_redirect&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 16px ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , &amp;#34;courier&amp;#34; , monospace ; background-color: rgb(249 , 249 , 250) ; color: rgb(34 , 34 , 34)&quot;&gt;&lt;br&gt;4.授权成功会把授权码和过期时间添加到授权链接&lt;/span&gt;&lt;span style=&quot;font-size: 16px ; color: rgb(34 , 34 , 34) ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , &amp;#34;courier&amp;#34; , monospace ; background-color: rgb(249 , 249 , 250)&quot;&gt;redirect_uri的参数上&lt;br&gt;&lt;br&gt;5.使用&lt;/span&gt;&lt;span style=&quot;color: rgb(34 , 34 , 34) ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , &amp;#34;courier&amp;#34; , monospace ; font-size: 16px ; background-color: rgb(249 , 249 , 250)&quot;&gt;授权码等相关参数&lt;/span&gt;&lt;span style=&quot;font-size: 16px ; color: rgb(34 , 34 , 34) ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , &amp;#34;courier&amp;#34; , monospace ; background-color: rgb(249 , 249 , 250)&quot;&gt;调用获取授权信息接口拿到授权信息&lt;br&gt;&lt;br&gt;6.拿到的授权信息中包含授权方&lt;/span&gt;&lt;span style=&quot;font-size: 16px ; color: rgb(34 , 34 , 34) ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , &amp;#34;courier&amp;#34; , monospace ; background-color: rgb(249 , 249 , 250)&quot;&gt;令牌&lt;/span&gt;&lt;span style=&quot;font-size: 16px ; color: rgb(34 , 34 , 34) ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , &amp;#34;courier&amp;#34; , monospace ; background-color: rgb(249 , 249 , 250)&quot;&gt;authorizer_acecess_token（2小时有效）和刷新令牌，授权方令牌可以调用获取Acess token接口进行缓存，在快过期前通过再次调用&lt;/span&gt;&lt;span style=&quot;font-size: 16px ; color: rgb(34 , 34 , 34) ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , &amp;#34;courier&amp;#34; , monospace ; background-color: rgb(249 , 249 , 250)&quot;&gt;获取Acess token接口&lt;/span&gt;&lt;span style=&quot;font-size: 16px ; color: rgb(34 , 34 , 34) ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , &amp;#34;courier&amp;#34; , monospace ; background-color: rgb(249 , 249 , 250)&quot;&gt;更新&lt;/span&gt;&lt;span style=&quot;background-color: rgb(249 , 249 , 250)&quot;&gt;&lt;font color=&quot;#222222&quot; face=&quot;consolas, liberation mono, menlo, courier, monospace&quot;&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;Acess token&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#222222&quot; face=&quot;consolas, liberation mono, menlo, courier, monospace&quot;&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;&amp;nbsp; 或者通过调用刷新token接口进行刷新授权方令牌（该接口每日有限额，官方建议使用上述缓存方法）&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;br&gt;&lt;font color=&quot;#222222&quot; face=&quot;consolas, liberation mono, menlo, courier, monospace&quot;&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;7.小程序第三方授权接口api：http://yapi.xesv5.com/project/896/interface/api/cat_3796&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , &amp;#34;courier&amp;#34; , monospace ; background-color: rgb(249 , 249 , 250) ; color: rgb(34 , 34 , 34)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/font&gt;&lt;div style=&quot;padding: 0px ; margin: 0px ; font-size: 16px&quot;&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="120" y="-265" width="1590" height="330" as="geometry" />
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-16" value="" style="endArrow=classic;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="780" y="240" as="sourcePoint" />
            <mxPoint x="1100" y="240" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-17" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1" target="qW-GwzM_9mIQ4SGtCaXA-3">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="780" y="640" as="sourcePoint" />
            <mxPoint x="830" y="160" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-18" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&lt;font style=&quot;font-size: 13px&quot;&gt;2.获取预授权码&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" vertex="1" parent="1">
          <mxGeometry x="880" y="200" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-19" value="" style="endArrow=classic;html=1;fillColor=#60a917;strokeColor=#2D7600;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1100" y="300" as="sourcePoint" />
            <mxPoint x="780" y="300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-20" value="&lt;span style=&quot;color: rgb(34 , 34 , 34) ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , &amp;#34;courier&amp;#34; , monospace ; text-align: left ; background-color: rgb(255 , 230 , 204)&quot;&gt;&lt;font style=&quot;font-size: 13px&quot;&gt;返回预授权码pre_auth_code&lt;/font&gt;&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" vertex="1" parent="1">
          <mxGeometry x="840" y="260" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-26" value="&lt;span style=&quot;font-size: 13px&quot;&gt;3.用户扫码拼接好的链接进行授权&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#6c8ebf;fillColor=#dae8fc;" vertex="1" parent="1">
          <mxGeometry x="510" y="320" width="210" height="20" as="geometry" />
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-27" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fillColor=#60a917;strokeColor=#2D7600;" edge="1" parent="1" target="qW-GwzM_9mIQ4SGtCaXA-4">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1100" y="640" as="sourcePoint" />
            <mxPoint x="1130" y="160" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-29" value="" style="endArrow=classic;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="460" y="240" as="sourcePoint" />
            <mxPoint x="780" y="240" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-30" value="获取授权链接" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" vertex="1" parent="1">
          <mxGeometry x="570" y="200" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-32" value="" style="endArrow=classic;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="780" y="300" as="sourcePoint" />
            <mxPoint x="460" y="300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-33" value="将拼接好的链接返回给用户" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" vertex="1" parent="1">
          <mxGeometry x="535" y="260" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-35" value="4.授权成功" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#2D7600;fillColor=#60a917;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="905" y="380" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-37" value="" style="endArrow=classic;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="120" y="360" as="sourcePoint" />
            <mxPoint x="1100" y="360" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-38" value="" style="endArrow=classic;html=1;fillColor=#60a917;strokeColor=#2D7600;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1102.5" y="420" as="sourcePoint" />
            <mxPoint x="780" y="420" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-39" value="" style="endArrow=classic;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="780" y="480" as="sourcePoint" />
            <mxPoint x="1100" y="480" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-40" value="5.获取授权信息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" vertex="1" parent="1">
          <mxGeometry x="890" y="440" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-43" value="" style="endArrow=classic;html=1;fillColor=#60a917;strokeColor=#2D7600;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1100" y="540" as="sourcePoint" />
            <mxPoint x="460" y="540" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-44" value="&lt;div style=&quot;text-align: left&quot;&gt;6.返回授权方令牌和刷新令牌&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#2D7600;fillColor=#60a917;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="690" y="500" width="170" height="20" as="geometry" />
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-46" value="调用小程序/公众号接口时需要携带授权方令牌" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#6c8ebf;fillColor=#dae8fc;" vertex="1" parent="1">
          <mxGeometry x="650" y="564.5" width="260" height="20" as="geometry" />
        </mxCell>
        <mxCell id="qW-GwzM_9mIQ4SGtCaXA-47" value="" style="endArrow=classic;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="460" y="600" as="sourcePoint" />
            <mxPoint x="1100" y="600" as="targetPoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
